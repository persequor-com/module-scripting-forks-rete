/*!
* rete v1.4.5 
* (c) 2021 Vitaliy Stoliarov 
* Released under the MIT license.
*/
!function(t){"use strict";var u,c,h,l,d,f,e,n=Object.prototype,p=n.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag",r="object"==typeof module,a=t.regeneratorRuntime;function v(t,e,n,r){var o,i,s,a,e=e&&e.prototype instanceof m?e:m,e=Object.create(e.prototype),r=new O(r||[]);return e._invoke=(o=t,i=n,s=r,a=c,function(t,e){if(a===l)throw new Error("Generator is already running");if(a===d){if("throw"===t)throw e;return S()}for(s.method=t,s.arg=e;;){var n=s.delegate;if(n){var r=function t(e,n){var r=e.iterator[n.method];if(r===u){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=u,t(e,n),"throw"===n.method))return f;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var r=y(r,e.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,f;r=r.arg;if(!r)return n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,f;{if(!r.done)return r;n[e.resultName]=r.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=u)}n.delegate=null;return f}(n,s);if(r){if(r===f)continue;return r}}if("next"===s.method)s.sent=s._sent=s.arg;else if("throw"===s.method){if(a===c)throw a=d,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);a=l;r=y(o,i,s);if("normal"===r.type){if(a=s.done?d:h,r.arg!==f)return{value:r.arg,done:s.done}}else"throw"===r.type&&(a=d,s.method="throw",s.arg=r.arg)}}),e}function y(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}function m(){}function g(){}function k(){}function w(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function b(s){var e;this._invoke=function(n,r){function t(){return new Promise(function(t,e){!function e(t,n,r,o){t=y(s[t],s,n);if("throw"!==t.type){var i=t.arg;return(n=i.value)&&"object"==typeof n&&p.call(n,"__await")?Promise.resolve(n.__await).then(function(t){e("next",t,r,o)},function(t){e("throw",t,r,o)}):Promise.resolve(n).then(function(t){i.value=t,r(i)},o)}o(t.arg)}(n,r,t,e)})}return e=e?e.then(t,t):t()}}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function C(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,t=function t(){for(;++n<e.length;)if(p.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=u,t.done=!0,t};return t.next=t}}return{next:S}}function S(){return{value:u,done:!0}}a?r&&(module.exports=a):((a=t.regeneratorRuntime=r?module.exports:{}).wrap=v,c="suspendedStart",h="suspendedYield",l="executing",d="completed",f={},(t={})[o]=function(){return this},(r=(r=Object.getPrototypeOf)&&r(r(C([]))))&&r!==n&&p.call(r,o)&&(t=r),e=k.prototype=m.prototype=Object.create(t),(g.prototype=e.constructor=k).constructor=g,k[s]=g.displayName="GeneratorFunction",a.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},a.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,k):(t.__proto__=k,s in t||(t[s]="GeneratorFunction")),t.prototype=Object.create(e),t},a.awrap=function(t){return{__await:t}},w(b.prototype),b.prototype[i]=function(){return this},a.AsyncIterator=b,a.async=function(t,e,n,r){var o=new b(v(t,e,n,r));return a.isGeneratorFunction(e)?o:o.next().then(function(t){return t.done?t.value:o.next()})},w(e),e[s]="Generator",e[o]=function(){return this},e.toString=function(){return"[object Generator]"},a.keys=function(n){var t,r=[];for(t in n)r.push(t);return r.reverse(),function t(){for(;r.length;){var e=r.pop();if(e in n)return t.value=e,t.done=!1,t}return t.done=!0,t}},a.values=C,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=u,this.done=!1,this.delegate=null,this.method="next",this.arg=u,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&p.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=u)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var r=this;function t(t,e){return i.type="throw",i.arg=n,r.next=t,e&&(r.method="next",r.arg=u),!!e}for(var e=this.tryEntries.length-1;0<=e;--e){var o=this.tryEntries[e],i=o.completion;if("root"===o.tryLoc)return t("end");if(o.tryLoc<=this.prev){var s=p.call(o,"catchLoc"),a=p.call(o,"finallyLoc");if(s&&a){if(this.prev<o.catchLoc)return t(o.catchLoc,!0);if(this.prev<o.finallyLoc)return t(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return t(o.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return t(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&p.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}var i=(o=o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc?null:o)?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),E(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r,o=n.completion;return"throw"===o.type&&(r=o.arg,E(n)),r}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:C(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=u),f}})}(function(){return this}()||Function("return this")()),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).Rete={})}(this,function(t){"use strict";function u(t,e,n,r,o,i,s){try{var a=t[i](s),u=a.value}catch(t){return void n(t)}a.done?e(u):Promise.resolve(u).then(r,o)}function f(a){return function(){var t=this,s=arguments;return new Promise(function(e,n){var r=a.apply(t,s);function o(t){u(r,e,n,o,i,"next",t)}function i(t){u(r,e,n,o,i,"throw",t)}o(void 0)})}}function p(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function v(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function y(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?Object(arguments[t]):{},r=Object.keys(n);(r="function"==typeof Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})):r).forEach(function(t){y(e,t,n[t])})}return e}function m(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}function i(t){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function n(t,e){return(n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function g(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function k(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=i(n);return t=r?(t=i(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),e=this,!(t=t)||"object"!=typeof t&&"function"!=typeof t?g(e):t}}function a(t,e,n){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){t=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=i(t)););return t}(t,e);if(t){e=Object.getOwnPropertyDescriptor(t,e);return e.get?e.get.call(n):e.value}})(t,e,n||t)}function c(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],s=!0,a=!1;try{for(n=n.call(t);!(s=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);s=!0);}catch(t){a=!0,o=t}finally{try{s||null==n.return||n.return()}finally{if(a)throw o}}return i}}(t,e)||h(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||h(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){if(t){if("string"==typeof t)return o(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(n="Object"===n&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,e):void 0}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function l(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=h(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,e=function(){};return{s:e,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return i=t.done,t},e:function(t){s=!0,o=t},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function d(t){p(this,d),y(this,"name",void 0),y(this,"data",{}),y(this,"engine",null),this.name=t}var b=function(){function o(t){p(this,o),y(this,"name",void 0),y(this,"id",void 0),y(this,"position",[0,0]),y(this,"inputs",new Map),y(this,"outputs",new Map),y(this,"controls",new Map),y(this,"data",{}),y(this,"meta",{}),this.name=t,this.id=o.incrementId()}return v(o,[{key:"_add",value:function(t,e,n){if(t.has(e.key))throw new Error("Item with key '".concat(e.key,"' already been added to the node"));if(null!==e[n])throw new Error("Item has already been added to some node");e[n]=this,t.set(e.key,e)}},{key:"addControl",value:function(t){return this._add(this.controls,t,"parent"),this}},{key:"removeControl",value:function(t){t.parent=null,this.controls.delete(t.key)}},{key:"addInput",value:function(t){return this._add(this.inputs,t,"node"),this}},{key:"removeInput",value:function(t){t.removeConnections(),t.node=null,this.inputs.delete(t.key)}},{key:"addOutput",value:function(t){return this._add(this.outputs,t,"node"),this}},{key:"removeOutput",value:function(t){t.removeConnections(),t.node=null,this.outputs.delete(t.key)}},{key:"getConnections",value:function(){return[].concat(w(this.inputs.values()),w(this.outputs.values())).reduce(function(t,e){return[].concat(w(t),w(e.connections))},[])}},{key:"update",value:function(){}},{key:"toJSON",value:function(){function t(t){return Array.from(t).reduce(function(t,e){var n=c(e,2),e=n[0],n=n[1];return t[e]=n.toJSON(),t},{})}return{id:this.id,data:this.data,inputs:t(this.inputs),outputs:t(this.outputs),position:this.position,name:this.name}}}],[{key:"incrementId",value:function(){return this.latestId?this.latestId++:this.latestId=1,this.latestId}},{key:"resetId",value:function(){this.latestId=0}},{key:"fromJSON",value:function(t){var e=new o(t.name),n=c(t.position,2),r=n[0],n=n[1];return e.id=t.id,e.data=t.data,e.position=[r,n],e.name=t.name,o.latestId=Math.max(e.id,o.latestId),e}}]),o}();y(b,"latestId",0);var e=function(){m(r,d);var t,e,n=k(r);function r(t){return p(this,r),y(g(t=n.call(this,t)),"editor",null),y(g(t),"data",{}),t}return v(r,[{key:"build",value:(e=f(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.builder(e);case 2:return t.abrupt("return",e);case 3:case"end":return t.stop()}},t,this)})),function(t){return e.apply(this,arguments)})},{key:"createNode",value:(t=f(regeneratorRuntime.mark(function t(){var e,n,r=arguments;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=0<r.length&&void 0!==r[0]?r[0]:{},(n=new b(this.name)).data=e,t.next=5,this.build(n);case 5:return t.abrupt("return",n);case 6:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})}]),r}(),x=function(){function n(t,e){p(this,n),y(this,"output",void 0),y(this,"input",void 0),y(this,"data",{}),this.output=t,this.input=e,this.data={},this.input.addConnection(this)}return v(n,[{key:"remove",value:function(){this.input.removeConnection(this),this.output.removeConnection(this)}}]),n}(),E=function(){function e(t){if(p(this,e),y(this,"key",void 0),y(this,"data",{}),y(this,"parent",null),this.constructor===e)throw new TypeError("Can not construct abstract class");if(!t)throw new Error("The key parameter is missing in super() of Control ");this.key=t}return v(e,[{key:"getNode",value:function(){if(null===this.parent)throw new Error("Control isn't added to Node/Input");if(this.parent instanceof b)return this.parent;if(!this.parent.node)throw new Error("Control hasn't be added to Input or Node");return this.parent.node}},{key:"getData",value:function(t){return this.getNode().data[t]}},{key:"putData",value:function(t,e){this.getNode().data[t]=e}}]),e}(),O=function(){function e(t){p(this,e),y(this,"events",{}),y(this,"silent",!1),this.events=t instanceof e?t.events:t.handlers}return v(e,[{key:"on",value:function(t,n){var r=this,t=t instanceof Array?t:t.split(" "),o={};return t.forEach(function(e){if(!r.events[e])throw new Error("The event ".concat(e," does not exist"));r.events[e].push(n),o[e]=function(){var t=r.events[e].length-1;r.events[e].splice(t,1)}}),function(){Object.values(o).forEach(function(t){return t()})}}},{key:"trigger",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!(t in this.events))throw new Error("The event ".concat(t," cannot be triggered"));return this.events[t].reduce(function(t,e){return!1!==e(n)&&t},!0)}},{key:"bind",value:function(t){if(this.events[t])throw new Error("The event ".concat(t," is already bound"));this.events[t]=[]}},{key:"exist",value:function(t){return Array.isArray(this.events[t])}}]),e}(),C=function(){function o(t,e,n,r){p(this,o),y(this,"node",null),y(this,"multipleConnections",void 0),y(this,"connections",[]),y(this,"key",void 0),y(this,"name",void 0),y(this,"socket",void 0),this.node=null,this.multipleConnections=r,this.connections=[],this.key=t,this.name=e,this.socket=n}return v(o,[{key:"removeConnection",value:function(t){this.connections.splice(this.connections.indexOf(t),1)}},{key:"removeConnections",value:function(){var e=this;this.connections.forEach(function(t){return e.removeConnection(t)})}}]),o}(),S=function(){m(i,C);var o=k(i);function i(t,e,n){var r=3<arguments.length&&void 0!==arguments[3]&&arguments[3];return p(this,i),y(g(r=o.call(this,t,e,n,r)),"control",null),r}return v(i,[{key:"hasConnection",value:function(){return 0<this.connections.length}},{key:"addConnection",value:function(t){if(!this.multipleConnections&&this.hasConnection())throw new Error("Multiple connections not allowed");this.connections.push(t)}},{key:"addControl",value:function(t){(this.control=t).parent=this}},{key:"showControl",value:function(){return!this.hasConnection()&&null!==this.control}},{key:"toJSON",value:function(){return{connections:this.connections.map(function(t){if(!t.output.node)throw new Error("Node not added to Output");return{node:t.output.node.id,output:t.output.key,data:t.data}})}}}]),i}(),N=function(){function t(){p(this,t)}return v(t,null,[{key:"isValidData",value:function(t){return"string"==typeof t.id&&this.isValidId(t.id)&&t.nodes instanceof Object&&!(t.nodes instanceof Array)}},{key:"isValidId",value:function(t){return/^[\w-]{3,}@[0-9]+\.[0-9]+\.[0-9]+$/.test(t)}},{key:"validate",value:function(t,e){var n=t.split("@"),r=e.id.split("@"),o=[];return this.isValidData(e)||o.push("Data is not suitable"),t!==e.id&&o.push("IDs not equal"),n[0]!==r[0]&&o.push("Names don't match"),n[1]!==r[1]&&o.push("Versions don't match"),{success:Boolean(!o.length),msg:o.join(". ")}}}]),t}(),R=function(){m(r,O);var n=k(r);function r(t,e){if(p(this,r),y(g(e=n.call(this,e)),"id",void 0),y(g(e),"plugins",void 0),y(g(e),"components",void 0),!N.isValidId(t))throw new Error("ID should be valid to name@0.1.0 format");return e.id=t,e.plugins=new Map,e.components=new Map,e}return v(r,[{key:"use",value:function(t,e){if(t.name&&this.plugins.has(t.name))throw new Error("Plugin ".concat(t.name," already in use"));t.install(this,e||{}),this.plugins.set(t.name,e)}},{key:"register",value:function(t){if(this.components.has(t.name))throw new Error("Component ".concat(t.name," already registered"));this.components.set(t.name,t),this.trigger("componentregister",t)}},{key:"destroy",value:function(){this.trigger("destroy")}}]),r}();function P(t,e){return window.addEventListener(t,e),function(){window.removeEventListener(t,e)}}function I(t){p(this,I),y(this,"handlers",void 0),this.handlers=s({warn:[console.warn],error:[console.error],componentregister:[],destroy:[]},t)}var _=function(){function s(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(t,e,n){},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:function(t){},r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:function(t){};p(this,s),this.onTranslate=e,this.onStart=n,this.onDrag=r,y(this,"pointerStart",void 0),y(this,"el",void 0),y(this,"destroy",void 0),this.pointerStart=null,this.el=t,this.el.style.touchAction="none",this.el.addEventListener("pointerdown",this.down.bind(this));var o=P("pointermove",this.move.bind(this)),i=P("pointerup",this.up.bind(this));this.destroy=function(){o(),i()}}return v(s,[{key:"down",value:function(t){"mouse"===t.pointerType&&0!==t.button||(t.stopPropagation(),this.pointerStart=[t.pageX,t.pageY],this.onStart(t))}},{key:"move",value:function(t){var e,n;this.pointerStart&&(t.preventDefault(),e=[(n=[t.pageX,t.pageY])[0]-this.pointerStart[0],n[1]-this.pointerStart[1]],n=this.el.getBoundingClientRect().width/this.el.offsetWidth,this.onTranslate(e[0]/n,e[1]/n,t))}},{key:"up",value:function(t){this.pointerStart&&(this.pointerStart=null,this.onDrag(t))}}]),s}(),j=function(){function a(t,e,n,r){p(this,a),y(this,"el",void 0),y(this,"intensity",void 0),y(this,"onzoom",void 0),y(this,"previous",null),y(this,"pointers",[]),y(this,"destroy",void 0),this.el=e,this.intensity=n,this.onzoom=r,t.addEventListener("wheel",this.wheel.bind(this)),t.addEventListener("pointerdown",this.down.bind(this)),t.addEventListener("dblclick",this.dblclick.bind(this));var o=P("pointermove",this.move.bind(this)),i=P("pointerup",this.end.bind(this)),s=P("pointercancel",this.end.bind(this));this.destroy=function(){o(),i(),s()}}return v(a,[{key:"translating",get:function(){return 2<=this.pointers.length}},{key:"wheel",value:function(t){t.preventDefault();var e=this.el.getBoundingClientRect(),n=t.deltaY<0?this.intensity:-this.intensity,r=(e.left-t.clientX)*n,t=(e.top-t.clientY)*n;this.onzoom(n,r,t,"wheel")}},{key:"touches",value:function(){var t={touches:this.pointers},e=[t.touches[0].clientX,t.touches[0].clientY],n=e[0],r=e[1],e=[t.touches[1].clientX,t.touches[1].clientY],t=e[0],e=e[1];return{cx:(n+t)/2,cy:(r+e)/2,distance:Math.sqrt(Math.pow(n-t,2)+Math.pow(r-e,2))}}},{key:"down",value:function(t){this.pointers.push(t)}},{key:"move",value:function(e){var t,n,r,o,i,s;this.pointers=this.pointers.map(function(t){return t.pointerId===e.pointerId?e:t}),this.translating&&(s=this.el.getBoundingClientRect(),t=(i=this.touches()).cx,n=i.cy,r=i.distance,null!==this.previous&&(o=r/this.previous.distance-1,i=(s.left-t)*o,s=(s.top-n)*o,this.onzoom(o,i-(this.previous.cx-t),s-(this.previous.cy-n),"touch")),this.previous={cx:t,cy:n,distance:r})}},{key:"end",value:function(e){this.previous=null,this.pointers=this.pointers.filter(function(t){return t.pointerId!==e.pointerId})}},{key:"dblclick",value:function(t){t.preventDefault();var e=this.el.getBoundingClientRect(),n=4*this.intensity,r=(e.left-t.clientX)*n,t=(e.top-t.clientY)*n;this.onzoom(n,r,t,"dblclick")}}]),a}(),L=function(){m(i,O);var o=k(i);function i(t,e){var n;p(this,i),y(g(n=o.call(this,e)),"el",void 0),y(g(n),"container",void 0),y(g(n),"transform",{k:1,x:0,y:0}),y(g(n),"mouse",{x:0,y:0}),y(g(n),"_startPosition",null),y(g(n),"_zoom",void 0),y(g(n),"_drag",void 0);var r=n.el=document.createElement("div");return n.container=t,r.style.transformOrigin="0 0",n._zoom=new j(t,r,.1,n.onZoom.bind(g(n))),n._drag=new _(t,n.onTranslate.bind(g(n)),n.onStart.bind(g(n))),e.on("destroy",function(){n._zoom.destroy(),n._drag.destroy()}),n.container.addEventListener("pointermove",n.pointermove.bind(g(n))),n.update(),n}return v(i,[{key:"update",value:function(){var t=this.transform;this.el.style.transform="translate(".concat(t.x,"px, ").concat(t.y,"px) scale(").concat(t.k,")")}},{key:"pointermove",value:function(t){var e=t.clientX,n=t.clientY,t=this.el.getBoundingClientRect(),e=e-t.left,n=n-t.top,t=this.transform.k;this.mouse={x:e/t,y:n/t},this.trigger("mousemove",s({},this.mouse))}},{key:"onStart",value:function(){this._startPosition=s({},this.transform)}},{key:"onTranslate",value:function(t,e){this._zoom.translating||this._startPosition&&this.translate(this._startPosition.x+t,this._startPosition.y+e)}},{key:"onZoom",value:function(t,e,n,r){this.zoom(this.transform.k*(1+t),e,n,r),this.update()}},{key:"translate",value:function(t,e){e={transform:this.transform,x:t,y:e};this.trigger("translate",e)&&(this.transform.x=e.x,this.transform.y=e.y,this.update(),this.trigger("translated"))}},{key:"zoom",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,r=3<arguments.length?arguments[3]:void 0,o=this.transform.k,i={transform:this.transform,zoom:t,source:r};this.trigger("zoom",i)&&(t=(o-i.zoom)/(o-t||1),this.transform.k=i.zoom||1,this.transform.x+=e*t,this.transform.y+=n*t,this.update(),this.trigger("zoomed",{source:r}))}},{key:"appendChild",value:function(t){this.el.appendChild(t)}},{key:"removeChild",value:function(t){this.el.removeChild(t)}}]),i}(),T=function(){m(i,O);var o=k(i);function i(t,e,n,r){return p(this,i),y(g(r=o.call(this,r)),"connection",void 0),y(g(r),"inputNode",void 0),y(g(r),"outputNode",void 0),y(g(r),"el",void 0),r.connection=t,r.inputNode=e,r.outputNode=n,r.el=document.createElement("div"),r.el.style.position="absolute",r.el.style.zIndex="-1",r.trigger("renderconnection",{el:r.el,connection:r.connection,points:r.getPoints()}),r}return v(i,[{key:"getPoints",value:function(){var t=c(this.outputNode.getSocketPosition(this.connection.output),2),e=t[0],n=t[1],t=c(this.inputNode.getSocketPosition(this.connection.input),2);return[e,n,t[0],t[1]]}},{key:"update",value:function(){this.trigger("updateconnection",{el:this.el,connection:this.connection,points:this.getPoints()})}}]),i}(),A=function(){m(o,O);var r=k(o);function o(t,e,n){return p(this,o),(n=r.call(this,n)).trigger("rendercontrol",{el:t,control:e}),n}return o}(),D=function(){m(s,O);var i=k(s);function s(t,e,n,r,o){return p(this,s),y(g(o=i.call(this,o)),"el",void 0),y(g(o),"type",void 0),y(g(o),"io",void 0),y(g(o),"node",void 0),o.el=t,o.type=e,o.io=n,o.node=r,o.trigger("rendersocket",(y(t={el:t},e,o.io),y(t,"socket",n.socket),t)),o}return v(s,[{key:"getPosition",value:function(t){var e=t.position,t=this.el;return[e[0]+t.offsetLeft+t.offsetWidth/2,e[1]+t.offsetTop+t.offsetHeight/2]}}]),s}(),z=function(){m(i,O);var o=k(i);function i(t,e,n){var r;return p(this,i),y(g(r=o.call(this,n)),"node",void 0),y(g(r),"component",void 0),y(g(r),"sockets",new Map),y(g(r),"controls",new Map),y(g(r),"el",void 0),y(g(r),"_startPosition",[]),y(g(r),"_drag",void 0),r.node=t,r.component=e,r.el=document.createElement("div"),r.el.style.position="absolute",r.el.addEventListener("contextmenu",function(t){return r.trigger("contextmenu",{e:t,node:r.node})}),r._drag=new _(r.el,r.onTranslate.bind(g(r)),r.onSelect.bind(g(r)),function(){r.trigger("nodedraged",t),r.trigger("nodedragged",t)}),r.trigger("rendernode",{el:r.el,node:t,component:e.data,bindSocket:r.bindSocket.bind(g(r)),bindControl:r.bindControl.bind(g(r))}),r.update(),r}return v(i,[{key:"clearSockets",value:function(){var e=this,n=[].concat(w(this.node.inputs.values()),w(this.node.outputs.values()));this.sockets.forEach(function(t){n.includes(t.io)||e.sockets.delete(t.io)})}},{key:"bindSocket",value:function(t,e,n){this.clearSockets(),this.sockets.set(n,new D(t,e,n,this.node,this))}},{key:"bindControl",value:function(t,e){this.controls.set(e,new A(t,e,this))}},{key:"getSocketPosition",value:function(t){var e=this.sockets.get(t);if(!e)throw new Error("Socket not found for ".concat(t.name," with key ").concat(t.key));return e.getPosition(this.node)}},{key:"onSelect",value:function(t){t={node:this.node,accumulate:t.ctrlKey,e:t};this.onStart(),this.trigger("multiselectnode",t),this.trigger("selectnode",t)}},{key:"onStart",value:function(){this._startPosition=w(this.node.position)}},{key:"onTranslate",value:function(t,e){this.trigger("translatenode",{node:this.node,dx:t,dy:e})}},{key:"onDrag",value:function(t,e){t=this._startPosition[0]+t,e=this._startPosition[1]+e;this.translate(t,e)}},{key:"translate",value:function(t,e){var n=this.node,t={node:n,x:t,y:e};this.trigger("nodetranslate",t)&&(e=[(e=c(n.position,2))[0],e[1]],n.position[0]=t.x,n.position[1]=t.y,this.update(),this.trigger("nodetranslated",{node:n,prev:e}))}},{key:"update",value:function(){var t=c(this.node.position,2),e=t[0],t=t[1];this.el.style.transform="translate(".concat(e,"px, ").concat(t,"px)")}},{key:"remove",value:function(){}},{key:"destroy",value:function(){this._drag.destroy()}}]),i}(),M=function(){m(i,O);var o=k(i);function i(t,e,n){var r;return p(this,i),y(g(r=o.call(this,n)),"container",void 0),y(g(r),"components",void 0),y(g(r),"nodes",new Map),y(g(r),"connections",new Map),y(g(r),"area",void 0),r.container=t,r.components=e,r.container.style.overflow="hidden",r.container.addEventListener("click",r.click.bind(g(r))),r.container.addEventListener("contextmenu",function(t){return r.trigger("contextmenu",{e:t,view:g(r)})}),n.on("destroy",P("resize",r.resize.bind(g(r)))),n.on("destroy",function(){return r.nodes.forEach(function(t){return t.destroy()})}),r.on("nodetranslated",r.updateConnections.bind(g(r))),r.area=new L(t,g(r)),r.container.appendChild(r.area.el),r}return v(i,[{key:"addNode",value:function(t){var e=this.components.get(t.name);if(!e)throw new Error("Component ".concat(t.name," not found"));e=new z(t,e,this);this.nodes.set(t,e),this.area.appendChild(e.el)}},{key:"removeNode",value:function(t){var e=this.nodes.get(t);this.nodes.delete(t),e&&(this.area.removeChild(e.el),e.destroy())}},{key:"addConnection",value:function(t){if(!t.input.node||!t.output.node)throw new Error("Connection input or output not added to node");var e=this.nodes.get(t.input.node),n=this.nodes.get(t.output.node);if(!e||!n)throw new Error("View node not found for input or output");n=new T(t,e,n,this);this.connections.set(t,n),this.area.appendChild(n.el)}},{key:"removeConnection",value:function(t){var e=this.connections.get(t);this.connections.delete(t),e&&this.area.removeChild(e.el)}},{key:"updateConnections",value:function(t){var e=this;t.node.getConnections().forEach(function(t){t=e.connections.get(t);if(!t)throw new Error("Connection view not found");t.update()})}},{key:"resize",value:function(){var t=this.container;if(!t.parentElement)throw new Error("Container doesn't have parent element");var e=t.parentElement.clientWidth,n=t.parentElement.clientHeight;t.style.width=e+"px",t.style.height=n+"px"}},{key:"click",value:function(t){var e=this.container;e===t.target&&this.trigger("click",{e:t,container:e})}}]),i}(),Y=function(){function t(){p(this,t),y(this,"list",[])}return v(t,[{key:"add",value:function(t){1<arguments.length&&void 0!==arguments[1]&&arguments[1]?this.contains(t)||this.list.push(t):this.list=[t]}},{key:"clear",value:function(){this.list=[]}},{key:"remove",value:function(t){this.list.splice(this.list.indexOf(t),1)}},{key:"contains",value:function(t){return-1!==this.list.indexOf(t)}},{key:"each",value:function(t){this.list.forEach(t)}}]),t}(),G=function(){m(e,I);var t=k(e);function e(){return p(this,e),t.call(this,{nodecreate:[],nodecreated:[],noderemove:[],noderemoved:[],connectioncreate:[],connectioncreated:[],connectionremove:[],connectionremoved:[],translatenode:[],nodetranslate:[],nodetranslated:[],nodedraged:[],nodedragged:[],selectnode:[],multiselectnode:[],nodeselect:[],nodeselected:[],rendernode:[],rendersocket:[],rendercontrol:[],renderconnection:[],updateconnection:[],keydown:[],keyup:[],translate:[],translated:[],zoom:[],zoomed:[],click:[],mousemove:[],contextmenu:[],import:[],export:[],process:[],clear:[]})}return e}(),J=function(){m(o,R);var e,n=k(o);function o(t,e){var r;return p(this,o),y(g(r=n.call(this,t,new G)),"nodes",[]),y(g(r),"selected",new Y),y(g(r),"view",void 0),r.view=new M(e,r.components,g(r)),r.on("destroy",P("keydown",function(t){return r.trigger("keydown",t)})),r.on("destroy",P("keyup",function(t){return r.trigger("keyup",t)})),r.on("selectnode",function(t){var e=t.node,t=t.accumulate;return r.selectNode(e,t)}),r.on("nodeselected",function(){return r.selected.each(function(t){t=r.view.nodes.get(t);t&&t.onStart()})}),r.on("translatenode",function(t){var e=t.dx,n=t.dy;return r.selected.each(function(t){t=r.view.nodes.get(t);t&&t.onDrag(e,n)})}),r}return v(o,[{key:"addNode",value:function(t){this.trigger("nodecreate",t)&&(this.nodes.push(t),this.view.addNode(t),this.trigger("nodecreated",t))}},{key:"removeNode",value:function(t){var e=this;this.trigger("noderemove",t)&&(t.getConnections().forEach(function(t){return e.removeConnection(t)}),this.nodes.splice(this.nodes.indexOf(t),1),this.view.removeNode(t),this.trigger("noderemoved",t))}},{key:"connect",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(this.trigger("connectioncreate",{output:t,input:e}))try{var r=t.connectTo(e);r.data=n,this.view.addConnection(r),this.trigger("connectioncreated",r)}catch(t){this.trigger("warn",t)}}},{key:"removeConnection",value:function(t){this.trigger("connectionremove",t)&&(this.view.removeConnection(t),t.remove(),this.trigger("connectionremoved",t))}},{key:"selectNode",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(-1===this.nodes.indexOf(t))throw new Error("Node not exist in list");this.trigger("nodeselect",t)&&(this.selected.add(t,e),this.trigger("nodeselected",t))}},{key:"getComponent",value:function(t){var e=this.components.get(t);if(!e)throw"Component ".concat(t," not found");return e}},{key:"register",value:function(t){a(i(o.prototype),"register",this).call(this,t),t.editor=this}},{key:"clear",value:function(){var e=this;w(this.nodes).forEach(function(t){return e.removeNode(t)}),this.trigger("clear")}},{key:"toJSON",value:function(){var e={id:this.id,nodes:{}};return this.nodes.forEach(function(t){return e.nodes[t.id]=t.toJSON()}),this.trigger("export",e),e}},{key:"beforeImport",value:function(t){var e=N.validate(this.id,t);return e.success?(this.silent=!0,this.clear(),this.trigger("import",t),!0):(this.trigger("warn",e.msg),!1)}},{key:"afterImport",value:function(){return!(this.silent=!1)}},{key:"fromJSON",value:(e=f(regeneratorRuntime.mark(function t(o){var s,a=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.beforeImport(o)){t.next=2;break}return t.abrupt("return",!1);case 2:return s={},t.prev=3,t.next=6,Promise.all(Object.keys(o.nodes).map(function(){var e=f(regeneratorRuntime.mark(function t(e){var n,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=o.nodes[e],r=a.getComponent(n.name),t.next=4,r.build(b.fromJSON(n));case 4:s[e]=t.sent,a.addNode(s[e]);case 6:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}()));case 6:Object.keys(o.nodes).forEach(function(t){var e=o.nodes[t],i=s[t];Object.keys(e.outputs).forEach(function(o){e.outputs[o].connections.forEach(function(t){var e=t.node,n=t.data,r=i.outputs.get(o),t=s[e].inputs.get(t.input);if(!r||!t)return a.trigger("error","IO not found for node ".concat(i.id));a.connect(r,t,n)})})}),t.next=13;break;case 9:return t.prev=9,t.t0=t.catch(3),this.trigger("warn",t.t0),t.abrupt("return",!this.afterImport());case 13:return t.abrupt("return",this.afterImport());case 14:case"end":return t.stop()}},t,this,[[3,9]])})),function(t){return e.apply(this,arguments)})}]),o}(),B=function(){m(i,C);var o=k(i);function i(t,e,n){var r=!(3<arguments.length&&void 0!==arguments[3])||arguments[3];return p(this,i),o.call(this,t,e,n,r)}return v(i,[{key:"hasConnection",value:function(){return 0<this.connections.length}},{key:"connectTo",value:function(t){if(!this.socket.compatibleWith(t.socket))throw new Error("Sockets not compatible");if(!t.multipleConnections&&t.hasConnection())throw new Error("Input already has one connection");if(!this.multipleConnections&&this.hasConnection())throw new Error("Output already has one connection");t=new x(this,t);return this.connections.push(t),t}},{key:"connectedTo",value:function(e){return this.connections.some(function(t){return t.input===e})}},{key:"toJSON",value:function(){return{connections:this.connections.map(function(t){if(!t.input.node)throw new Error("Node not added to Input");return{node:t.input.node.id,input:t.input.key,data:t.data}})}}}]),i}(),W=function(){function n(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};p(this,n),y(this,"name",void 0),y(this,"data",void 0),y(this,"compatible",[]),this.name=t,this.data=e,this.compatible=[]}return v(n,[{key:"combineWith",value:function(t){this.compatible.push(t)}},{key:"compatibleWith",value:function(t){return this===t||this.compatible.includes(t)}}]),n}();var V=function(){function e(t){p(this,e),y(this,"nodes",void 0),this.nodes=t}return v(e,[{key:"extractInputNodes",value:function(n){var r=this;return Object.keys(n.inputs).reduce(function(t,e){e=(n.inputs[e].connections||[]).reduce(function(t,e){return[].concat(w(t),[r.nodes[e.node]])},[]);return[].concat(w(t),w(e))},[])}},{key:"findSelf",value:function(t,e){var n,r=(n=e,t.filter(function(t){return-1!==n.indexOf(t)}));if(r.length)return r[0];var o,i=l(e);try{for(i.s();!(o=i.n()).done;){var s=o.value,a=[s].concat(w(t)),u=this.findSelf(a,this.extractInputNodes(s));if(u)return u}}catch(t){i.e(t)}finally{i.f()}return null}},{key:"detect",value:function(){var t,e=this,n=l(Object.keys(this.nodes).map(function(t){return e.nodes[t]}));try{for(n.s();!(t=n.n()).done;){var r=t.value,o=this.findSelf([r],this.extractInputNodes(r));if(o)return o}}catch(t){n.e(t)}finally{n.f()}return null}}]),e}(),X=0,F=1,U=2,q=function(){m(e,I);var t=k(e);function e(){return p(this,e),t.call(this,{})}return e}(),H=function(){m(d,R);var e,t,n,r,o,i,s,a,u,c,h,l=k(d);function d(t){return p(this,d),y(g(t=l.call(this,t,new q)),"args",[]),y(g(t),"data",null),y(g(t),"state",X),y(g(t),"onAbort",function(){}),t}return v(d,[{key:"clone",value:function(){var e=new d(this.id);return this.components.forEach(function(t){return e.register(t)}),e}},{key:"throwError",value:(h=f(regeneratorRuntime.mark(function t(e){var n,r=arguments;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=1<r.length&&void 0!==r[1]?r[1]:null,t.next=3,this.abort();case 3:return this.trigger("error",{message:e,data:n}),this.processDone(),t.abrupt("return","error");case 6:case"end":return t.stop()}},t,this)})),function(t){return h.apply(this,arguments)})},{key:"processStart",value:function(){return this.state===X?(this.state=F,!0):(this.state===U||console.warn("The process is busy and has not been restarted.\n                Use abort() to force it to complete"),!1)}},{key:"processDone",value:function(){var t=this.state!==U;return this.state=X,t||(this.onAbort(),this.onAbort=function(){}),t}},{key:"abort",value:(c=f(regeneratorRuntime.mark(function t(){var e=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(t){e.state===F?(e.state=U,e.onAbort=t):e.state===U?(e.onAbort(),e.onAbort=t):t()}));case 1:case"end":return t.stop()}},t)})),function(){return c.apply(this,arguments)})},{key:"lock",value:(u=f(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(t){e.unlockPool=e.unlockPool||[],e.busy&&!e.outputData?e.unlockPool.push(t):t(),e.busy=!0}));case 1:case"end":return t.stop()}},t)})),function(t){return u.apply(this,arguments)})},{key:"unlock",value:function(t){t.unlockPool.forEach(function(t){return t()}),t.unlockPool=[],t.busy=!1}},{key:"extractInputData",value:(a=f(regeneratorRuntime.mark(function t(e){var n,r,o,i,s,a=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n={},r=0,o=Object.keys(e.inputs);case 2:if(r<o.length)return i=o[r],s=e.inputs[i],s=s.connections,t.next=8,Promise.all(s.map(function(){var e=f(regeneratorRuntime.mark(function t(e){var n,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=a.data.nodes[e.node],t.next=3,a.processNode(n);case 3:if(r=t.sent){t.next=8;break}a.abort(),t.next=9;break;case 8:return t.abrupt("return",r[e.output]);case 9:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}()));t.next=13;break;case 8:s=t.sent,n[i]=s;case 10:r++,t.next=2;break;case 13:return t.abrupt("return",n);case 14:case"end":return t.stop()}},t)})),function(t){return a.apply(this,arguments)})},{key:"processWorker",value:(s=f(regeneratorRuntime.mark(function t(e){var n,r,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.extractInputData(e);case 2:return n=t.sent,r=this.components.get(e.name),o={},t.prev=5,t.next=8,r.worker.apply(r,[e,n,o].concat(w(this.args)));case 8:t.next=14;break;case 10:t.prev=10,t.t0=t.catch(5),this.abort(),this.trigger("warn",t.t0);case 14:return t.abrupt("return",o);case 15:case"end":return t.stop()}},t,this,[[5,10]])})),function(t){return s.apply(this,arguments)})},{key:"processNode",value:(i=f(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.state!==U&&e){t.next=2;break}return t.abrupt("return",null);case 2:return t.next=4,this.lock(e);case 4:if(e.outputData){t.next=8;break}return t.next=7,this.processWorker(e);case 7:e.outputData=t.sent;case 8:return this.unlock(e),t.abrupt("return",e.outputData);case 10:case"end":return t.stop()}},t,this)})),function(t){return i.apply(this,arguments)})},{key:"forwardProcess",value:(o=f(regeneratorRuntime.mark(function t(r){var o=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.state===U)return t.abrupt("return",null);t.next=2;break;case 2:return t.next=4,Promise.all(Object.keys(r.outputs).map(function(){var e=f(regeneratorRuntime.mark(function t(e){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.outputs[e],t.next=3,Promise.all(n.connections.map(function(){var e=f(regeneratorRuntime.mark(function t(e){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=o.data.nodes[e.node],t.next=3,o.processNode(n);case 3:return t.next=5,o.forwardProcess(n);case 5:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}()));case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}()));case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}},t,this)})),function(t){return o.apply(this,arguments)})},{key:"copy",value:function(e){return(e=Object.assign({},e)).nodes=Object.assign({},e.nodes),Object.keys(e.nodes).forEach(function(t){e.nodes[t]=Object.assign({},e.nodes[t])}),e}},{key:"validate",value:(r=f(regeneratorRuntime.mark(function t(e){var n,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=N.validate(this.id,e),n=new V(e.nodes),r.success){t.next=6;break}return t.next=5,this.throwError(r.msg);case 5:return t.abrupt("return",t.sent);case 6:if(r=n.detect())return t.next=10,this.throwError("Recursion detected",r);t.next=11;break;case 10:return t.abrupt("return",t.sent);case 11:return t.abrupt("return",!0);case 12:case"end":return t.stop()}},t,this)})),function(t){return r.apply(this,arguments)})},{key:"processStartNode",value:(n=f(regeneratorRuntime.mark(function t(e){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:if(n=this.data.nodes[e]){t.next=7;break}return t.next=6,this.throwError("Node with such id not found");case 6:return t.abrupt("return",t.sent);case 7:return t.next=9,this.processNode(n);case 9:return t.next=11,this.forwardProcess(n);case 11:case"end":return t.stop()}},t,this)})),function(t){return n.apply(this,arguments)})},{key:"processUnreachable",value:(t=f(regeneratorRuntime.mark(function t(){var e,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=this.data,t.t0=regeneratorRuntime.keys(e.nodes);case 2:if((t.t1=t.t0()).done){t.next=12;break}if(n=t.t1.value,void 0===(n=e.nodes[n]).outputData)return t.next=8,this.processNode(n);t.next=10;break;case 8:return t.next=10,this.forwardProcess(n);case 10:t.next=2;break;case 12:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})},{key:"process",value:(e=f(regeneratorRuntime.mark(function t(e){var n,r,o,i,s=arguments;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=1<s.length&&void 0!==s[1]?s[1]:null,this.processStart()){t.next=3;break}return t.abrupt("return");case 3:if(this.validate(e)){t.next=5;break}return t.abrupt("return");case 5:for(this.data=this.copy(e),r=s.length,o=new Array(2<r?r-2:0),i=2;i<r;i++)o[i-2]=s[i];return this.args=o,t.next=10,this.processStartNode(n);case 10:return t.next=12,this.processUnreachable();case 12:return t.abrupt("return",this.processDone()?"success":"aborted");case 13:case"end":return t.stop()}},t,this)})),function(t){return e.apply(this,arguments)})}]),d}();console.log("USING LOCAL RETE");var Z={Engine:H,Recursion:V,Component:e,Control:E,Connection:x,Emitter:O,Input:S,IO:C,Node:b,NodeEditor:J,Output:B,Socket:W};t.Component=e,t.Connection=x,t.Control=E,t.Emitter=O,t.Engine=H,t.IO=C,t.Input=S,t.Node=b,t.NodeEditor=J,t.Output=B,t.Recursion=V,t.Socket=W,t.default=Z,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=rete.min.js.map
